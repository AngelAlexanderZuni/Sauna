@page
@model ProyectoSaunaKalixto.Web.Pages.DashboardModel
@{
    ViewData["Title"] = "Dashboard";
    Layout = "_LayoutSidebar";
}

<style>

/* =============================== */
/* ðŸ”¥ ULTRA LEGENDARIO - KALIXTO ðŸš€ */
/* =============================== */

:root {
    --aurora-1: oklch(0.78 0.24 295);
    --aurora-2: oklch(0.75 0.18 260);
    --aurora-3: oklch(0.72 0.22 305);
    --glass-bg: rgba(255,255,255,0.08);
    --glass-border: rgba(255,255,255,0.17);
    --shadow-neo: rgba(0,0,0,0.45);
    --text-main: #fafafa;
    --text-muted: #c5c5c5;
    --danger: oklch(0.65 0.24 27);
    --success: oklch(0.71 0.18 155);
}

/* AURORA ANIMADA  */
body::before {
    content: "";
    position: fixed;
    top: -20%;
    left: -20%;
    width: 140%;
    height: 140%;
    background: radial-gradient(circle at 30% 20%, var(--aurora-1), transparent 60%),
                radial-gradient(circle at 70% 80%, var(--aurora-2), transparent 60%),
                radial-gradient(circle at 80% 30%, var(--aurora-3), transparent 60%);
    filter: blur(140px);
    z-index: -1;
    animation: auroraMove 16s infinite alternate ease-in-out;
}

@@keyframes auroraMove {
    0% { transform: translateY(-20px); }
    100% { transform: translateY(20px); }
}

/* Tarjetas ULTRA Glass */
.ultra-card {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(20px);
    border-radius: 22px;
    box-shadow: 0 8px 35px var(--shadow-neo);
    padding: 28px;
    transition: all .3s ease;
    position: relative;
    overflow: hidden;
}

.ultra-card::after {
    content: "";
    position: absolute;
    top: -120%;
    left: -120%;
    width: 300%;
    height: 300%;
    background: conic-gradient(
        from 180deg,
        transparent,
        var(--aurora-1),
        var(--aurora-2),
        transparent
    );
    opacity: .14;
    animation: rotateGlow 12s infinite linear;
}

@@keyframes rotateGlow {
    to { transform: rotate(360deg); }
}

.ultra-card:hover {
    transform: translateY(-6px) scale(1.015);
    box-shadow: 0 14px 45px rgba(0,0,0,.55);
}

/* TÃ­tulos */
.ultra-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-main);
}

.ultra-sub {
    color: var(--text-muted);
    font-size: .9rem;
}

/* BotÃ³n ULTRA */
.ultra-btn {
    background: linear-gradient(135deg, var(--aurora-1), var(--aurora-3));
    color: white;
    padding: .8rem 1.4rem;
    border-radius: 14px;
    font-weight: 600;
    box-shadow: 0 6px 20px rgba(0,0,0,.4);
    transition: all .25s ease;
}

.ultra-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 32px rgba(0,0,0,.55);
    filter: brightness(1.2);
}

/* Tabla Legendaria */
.ultra-table tbody tr {
    transition: .25s ease;
}

.ultra-table tbody tr:hover {
    background: rgba(255,255,255,0.14);
    backdrop-filter: blur(12px);
}

/* Animaciones */
.fade {
    animation: fade .65s ease-out forwards;
}
@@keyframes fade {
    from {opacity:0; transform:translateY(12px);}
    to   {opacity:1; transform:translateY(0);}
}
</style>


<div class="p-6 space-y-6">

    <!-- HEADER -->
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-semibold" style="color: var(--foreground);">Dashboard</h1>
            <p class="text-sm mt-1" style="color: var(--muted-foreground);">Bienvenido, @Model.UsuarioNombre â€” @Model.UsuarioRol</p>
        </div>

        
    </div>

    <!-- TARJETAS -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">

        <div class="card p-6">
            <p class="text-sm" style="color: var(--muted-foreground);">Total Clientes</p>
            <h2 class="text-3xl font-bold" style="color: var(--foreground);">@Model.TotalClientes</h2>
        </div>

        <div class="card p-6">
            <p class="text-sm" style="color: var(--muted-foreground);">Cuentas abiertas</p>
            <h2 class="text-3xl font-bold" style="color: var(--foreground);">@Model.CuentasAbiertas</h2>
        </div>

        <div class="card p-6">
            <p class="text-sm" style="color: var(--muted-foreground);">Registros Hoy</p>
            <h2 class="text-3xl font-bold" style="color: var(--foreground);">@Model.RegistrosHoy</h2>
        </div>

        <div class="card p-6">
            <p class="text-sm" style="color: var(--muted-foreground);">SesiÃ³n</p>
            <h2 class="text-xl font-bold" style="color: var(--foreground);">@Model.UsuarioNombre</h2>
        </div>
    </div>

    <!-- INGRESOS HOY -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="card p-6">
            <p class="text-sm" style="color: var(--muted-foreground);">Ingresos Hoy</p>
            <h2 class="text-3xl font-bold" style="color: var(--foreground);">S/ @String.Format("{0:N2}", Model.IngresosHoy)</h2>
        </div>
        <div class="card p-6">
            <p class="text-sm" style="color: var(--muted-foreground);">Egresos Hoy</p>
            <h2 class="text-3xl font-bold" style="color: var(--foreground);">S/ @String.Format("{0:N2}", Model.EgresosHoy)</h2>
        </div>
    </div>

    <!-- GRÃFICO INGRESOS ÃšLTIMOS 7 DÃAS -->
    <div class="card p-6" style="overflow:hidden;">
        <h3 class="text-lg font-semibold mb-4" style="color: var(--foreground);">Ingresos Ãºltimos 7 dÃ­as</h3>
        <div class="relative w-full" style="height: 320px; max-height: 320px;">
            <canvas id="ingresosChart" class="w-full h-full"></canvas>
        </div>
    </div>

    <!-- TABLA -->
    <div class="card p-6 overflow-hidden">
        <h3 class="text-lg font-semibold mb-4" style="color: var(--foreground);">Actividad Reciente</h3>

        <table class="w-full">
            <thead style="background-color: var(--muted);" class="text-left">
                <tr>
                    <th class="px-4 py-3 text-xs font-medium uppercase" style="color: var(--muted-foreground);">Fecha</th>
                    <th class="px-4 py-3 text-xs font-medium uppercase" style="color: var(--muted-foreground);">Cliente</th>
                    <th class="px-4 py-3 text-xs font-medium uppercase text-right" style="color: var(--muted-foreground);">Monto</th>
                    <th class="px-4 py-3 text-right text-xs font-medium uppercase" style="color: var(--muted-foreground);">Cuenta</th>
                </tr>
            </thead>
            <tbody style="background-color: var(--card);">
                @if (!Model.PagosRecientes.Any())
                {
                    <tr class="border-t" style="border-color: var(--border);">
                        <td colspan="4" class="px-4 py-4 text-center" style="color: var(--muted-foreground);">Sin pagos recientes</td>
                    </tr>
                }
                else
                {
                    @foreach (var p in Model.PagosRecientes)
                    {
                        <tr class="border-t" style="border-color: var(--border);">
                            <td class="px-4 py-3">@p.Fecha.ToString("dd/MM/yyyy HH:mm")</td>
                            <td class="px-4 py-3">@p.Cliente</td>
                            <td class="px-4 py-3 text-right">S/ @String.Format("{0:N2}", p.Monto)</td>
                            <td class="px-4 py-3 text-right">@p.IdCuenta</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

</div>




<!-- ============== SCRIPTS ============== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const labels = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ChartFechas));
    const data = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ChartIngresos));
    const primary = getComputedStyle(document.documentElement).getPropertyValue('--primary') || '#4f46e5';
    new Chart(document.getElementById('ingresosChart'), {
        type: 'line',
        data: { labels, datasets: [{ label: 'Ingresos', data, borderColor: primary, tension: .3 }] },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
    });
</script>
